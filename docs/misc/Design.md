---
nav_exclude: true
---

# 大作业设计

我和王一辉目前的想法是在 [19 级大作业 JVVM][1] 的基础上进行改进作为本次的大作业。作业
量与 JVVM 完整版相近，约 4000 行代码。

相比于 JVVM，最主要的改动为把基本指令的执行提前到第二次作业及加入 debugger。如果
时间安排充足，可以考虑实现更高级的 JVM 特性。

## 总体结构

- Lab1：Class 文件查找与解析

  实现一个简化版的 [`javap`][2]，解析 class 文件内容并打印在命令行中。

  预计代码量 800 行，但类的解析部分逻辑较为简单，主要工作为读手册。

  Lab1 约对应于 JVVM Lab1、2、3 与 [JVM Specification Chapter 4][3] 的内容，但有
  所简化：Attribute 等仅在运行时需要的内容放到后面。（个人认为 JVVM 这部分占用时
  间太长，导致后面更难的类初始化、执行等内容时间不够。因此压缩为一个 lab。）

- Lab2：简单指令的执行

  我们打算把算术、控制、函数调用等不依赖于类的指令与其他指令分开布置。这些指令可
  以与结构化程序的语句直接对应，因此不需要实现学习面向对象相关知识。然而，由于需
  要解析指令和常量池，Lab 2 仍然依赖于 Lab 1。

  预计代码量：1500 行。由于指令执行部分代码量较大，我们打算把 Lab2 分为三个小部分：

  - Lab 2.1：简易调试器

    预计代码量：200 行？（由于这不是 JVM 的核心，我们打算在框架中实现大部分的内
    容，减轻作业压力。）

    我们当时做大作业时碰到的一个问题是指令的执行难以调试，因此这次希望加入一个简
    易的字节码调试器来帮助同学们调试 JVM，调试器包括打印栈帧、单步执行和断点等基
    本功能。

    调试器放在 Lab2 的最前面，这样后面都可以用到。

  - Lab 2.2：基本算术指令

    预计代码量：700 行

    最基本的 JVM 指令，对应于规范中的 loads、stores、math、stack、conversions 四
    个类型，不涉及控制流、函数调用等内容，但需要实现操作数栈、局部变
    量表和 PC。

  - Lab 2.3：控制流与静态方法调用

    预计代码量：600 行

    实现规范中的 control、comparisons 两类指令及 invokestatic（仅限于同一个类的
    静态方法）。至此就有了一个 Turing Complete 的虚拟机。

- Lab 3：运行时环境（大概构思）

  预计代码量：1500 ~ 2000 行

  Lab 3 中实现类初始化、虚函数调用等内容及对应的指令。完成 Lab 3 之后 JVM 应该能
  正常运行大部分的类。

  （更具体的内容？？？）

- Lab 4：高级 JVM 内容

  这部分是可选内容，应该是根据课程安排来决定是否做以及做什么。

  可能的内容：GC、反射等。

[1]: https://minguw.gitbook.io/jvm
[2]: https://docs.oracle.com/en/java/javase/17/docs/specs/man/javap.html
[3]: https://docs.oracle.com/javase/specs/jvms/se17/jvms17.pdf
